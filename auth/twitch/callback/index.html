<!DOCTYPE html>
<html>
<head>
  <title>Twitch Login Callback</title>
  <meta charset="utf-8">
</head>
<body>
  <script>
    const clientId = 'of7hb08b4r8e891rfh678346ctns5l';
    const redirectUri = 'https://www.multistreamgrid.com/auth/twitch/callback';
    const scopes = [
      'chat:read',
      'chat:edit',
      'user:read:subscriptions'
    ].join('+');
    const authUrl = `https://id.twitch.tv/oauth2/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=token&scope=${scopes}`;

    // Helper to extract access_token from hash
    function getTokenFromHash() {
      const match = window.location.hash.match(/access_token=([^&]+)/);
      return match ? match[1] : null;
    }

    // Try to get token from hash or localStorage
    let token = getTokenFromHash();
    if (token) {
      localStorage.setItem('twitch_access_token', token);
      // Optionally, remove the token from the URL for cleanliness
      window.location.hash = '';
    } else {
      token = localStorage.getItem('twitch_access_token');
    }

    // If no token, redirect to Twitch
    if (!token) {
      window.location = authUrl;
    } else {
      // You have a token, use it as needed
      // Example: console.log('Twitch token:', token);
    }
  </script>
</body>
</html>
