<!DOCTYPE html>
<html>
<head>
  <title>Twitch Login Callback</title>
  <meta charset="utf-8">
</head>
<body>
  <script>
    const clientId = 'of7hb08b4r8e891rfh678346ctns5l';
    const redirectUri = 'https://www.multistreamgrid.com/auth/twitch/callback';
    const scopes = [
      'chat:read',
      'chat:edit',
      'user:read:subscriptions'
    ].join('+');
    const authUrl = `https://id.twitch.tv/oauth2/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=token&scope=${scopes}`;

    function getTokenFromHash() {
      const match = window.location.hash.match(/access_token=([^&]+)/);
      return match ? match[1] : null;
    }
    function getErrorFromHash() {
      const match = window.location.hash.match(/error=([^&]+)/);
      return match ? match[1] : null;
    }

    let token = getTokenFromHash();
    let error = getErrorFromHash();

    if (token) {
      localStorage.setItem('twitch_access_token', token);
      window.location.hash = '';
      console.log('Token stored:', token);
      document.body.innerHTML = '<h2>Login successful! You can close this window.</h2>';
    } else if (error) {
      console.error('OAuth error:', error);
      document.body.innerHTML = `<h2>OAuth Error: ${error}</h2>`;
    } else {
      token = localStorage.getItem('twitch_access_token');
      if (!token) {
        console.log('No token found, redirecting to Twitch...');
        window.location = authUrl;
      } else {
        console.log('Token from storage:', token);
      }
    }
  </script>
</body>
</html>
